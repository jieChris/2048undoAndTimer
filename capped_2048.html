<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>2048封顶</title>

  <link href="style/main.css?v=1771576227074" rel="stylesheet" type="text/css">
  <link rel="shortcut icon" href="favicon.ico?v=42">
  <link rel="apple-touch-icon" href="meta/apple-touch-icon.png?v=42">
  <meta name="apple-mobile-web-app-capable" content="yes">

  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0, maximum-scale=1, user-scalable=no, minimal-ui">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; connect-src 'self' http://127.0.0.1:3001 http://localhost:3001; script-src 'self' 'unsafe-inline' https://www.google-analytics.com; style-src 'self' 'unsafe-inline';">
  <style>
    #guide-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 2000;
        display: none;
    }
    #guide-message {
        position: absolute;
        color: white;
        font-weight: bold;
        font-size: 24px;
        z-index: 2002;
        pointer-events: none;
    }
    #guide-arrow {
        font-size: 40px;
        display: block;
        line-height: 1;
        margin-bottom: 5px;
    }
    .guide-highlight {
        position: relative;
        z-index: 2001;
        background: #faf8ef;
        box-shadow: 0 0 0 5px #faf8ef, 0 0 20px 10px rgba(255, 255, 255, 0.5);
        border-radius: 4px;
    }
    .timer-scroll-btn {
        display: inline-block;
        background: #eee4da;
        border-radius: 3px;
        padding: 0 14px;
        text-decoration: none;
        color: #776e65;
        height: 32px;
        line-height: 32px;
        font-size: 13px;
        font-weight: bold;
        cursor: pointer;
        user-select: none;
        margin: 0 3px;
        font-family: 'Clear Sans', 'Helvetica Neue', Arial, sans-serif;
    }
    .timer-scroll-btn:hover {
        background: #ded4c8;
        color: #5a534c;
    }
    #timer-scroll-controls {
        display: none;
        text-align: center;
        clear: both;
        padding-top: 14px;
    }
  </style>
</head>
<body data-mode-id="capped_4x4_pow2_no_undo">
  <div id="guide-overlay">
      <div id="guide-message">
          <span id="guide-arrow">↑</span>
          点击这里返回首页
      </div>
  </div>
  <div class="container">
    <div class="stats-left">
      <div id="stats-4-rate">4率: 10%</div>
      <div id="stats-total">总步数: 0</div>
      <div id="stats-moves">移动步数: 0</div>
      <div id="stats-ips">IPS: 0</div>
    </div>
    <div class="stats-right" id="stats-ips-right"></div>
    <div class="heading">
      <div class="top-action-buttons">
        <a class="top-action-btn stats-panel-toggle" id="stats-panel-toggle" title="统计">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg>
        </a>
        <a class="top-action-btn" id="top-export-replay-btn" title="导出回放">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
        </a>
        <a class="top-action-btn" href="replay.html" title="高级回放">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 4v6h-6"></path><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path></svg>
        </a>
        <a class="top-action-btn" href="modes.html" title="模式选择">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
        </a>
        <a class="top-action-btn" id="top-settings-btn" title="设置">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
        </a>
      </div>
      <h1 class="title"><a href="index.html" style="text-decoration: none; color: inherit; cursor: pointer;">2048</a>封顶</h1>
      <div class="scores-container">
        <div class="score-container">0</div>
        <div class="best-container">0</div>
      </div>
      <div class="above-game" style="clear: both; padding-top: 15px;">
      <p class="game-intro">挑战模式自有惊喜</p>
      <a class="restart-button" title="新游戏">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>
      </a>
      </div>
    </div>

    <div id="timerbox">
        <div id="timer"></div>

        <div id="timer-rows-wrapper">
            <div class="timer-row-item" id="timer-row-16">
                <div class="timertile timer-legend-16" style="color: #f9f6f2; font-size: 22px;">16</div>
                <div class="timertile" id="timer16" style="margin-left:6px; width:187px"></div>
                <br><br>
            </div>
            <div class="timer-row-item" id="timer-row-32">
                <div class="timertile timer-legend-32" style="color: #f9f6f2; font-size: 22px;">32</div>
                <div class="timertile" id="timer32" style="margin-left:6px; width:187px"></div>
                <br><br>
            </div>
            <div class="timer-row-item" id="timer-row-64">
                <div class="timertile timer-legend-64" style="color: #f9f6f2; font-size: 22px;">64</div>
                <div class="timertile" id="timer64" style="margin-left:6px; width:187px"></div>
                <br><br>
            </div>
            <div class="timer-row-item" id="timer-row-128">
                <div class="timertile timer-legend-128" style="color: #f9f6f2; font-size: 18px;">128</div>
                <div class="timertile" id="timer128" style="margin-left:6px; width:187px"></div>
                <br><br>
            </div>
            <div class="timer-row-item" id="timer-row-256">
                <div class="timertile timer-legend-256" style="color: #f9f6f2; font-size: 18px;">256</div>
                <div class="timertile" id="timer256" style="margin-left:6px; width:187px"></div>
                <br><br>
            </div>
            <div class="timer-row-item" id="timer-row-512">
                <div class="timertile timer-legend-512" style="color: #f9f6f2; font-size: 18px;">512</div>
                <div class="timertile" id="timer512" style="margin-left:6px; width:187px"></div>
                <br><br>
            </div>
            <div class="timer-row-item" id="timer-row-1024">
                <div class="timertile timer-legend-1024" style="color: #f9f6f2; font-size: 14px;">1024</div>
                <div class="timertile" id="timer1024" style="margin-left:6px; width:187px"></div>
                <br><br>
            </div>
            <div class="timer-row-item" id="timer-row-2048">
                <div class="timertile timer-legend-2048" style="color: #f9f6f2; font-size: 14px;">2048</div>
                <div class="timertile" id="timer2048" style="margin-left:6px; width:187px"></div>
                <br><br>
            </div>
            <!-- Dynamic 2048 milestone rows appended here -->
            <div id="capped-timer-container"></div>
        </div>

        <div id="timer-scroll-controls">
            <a class="timer-scroll-btn" data-scroll-dir="-1">▲ 上移</a>
            <a class="timer-scroll-btn" data-scroll-dir="1">▼ 下移</a>
        </div>
    </div>



    <div class="game-container">
      <div class="game-message">
        <p></p>
        <div class="lower">
          <a class="retry-button">重试</a>
        </div>
      </div>


      <div class="grid-container">
        <div class="grid-row">
          <div class="grid-cell"></div>
          <div class="grid-cell"></div>
          <div class="grid-cell"></div>
          <div class="grid-cell"></div>
        </div>
        <div class="grid-row">
          <div class="grid-cell"></div>
          <div class="grid-cell"></div>
          <div class="grid-cell"></div>
          <div class="grid-cell"></div>
        </div>
        <div class="grid-row">
          <div class="grid-cell"></div>
          <div class="grid-cell"></div>
          <div class="grid-cell"></div>
          <div class="grid-cell"></div>
        </div>
        <div class="grid-row">
          <div class="grid-cell"></div>
          <div class="grid-cell"></div>
          <div class="grid-cell"></div>
          <div class="grid-cell"></div>
        </div>
      </div>

      <div class="tile-container">
      </div>
    </div>
    <hr>
    <p class="game-explanation">
      <strong class="important">新春快乐，马年大吉！</strong>
    </p>

  </div>

  <div id="replay-modal" class="replay-modal-overlay" style="display: none;">
    <div class="replay-modal-content">
      <h3 id="replay-modal-title">回放</h3>
      <textarea id="replay-textarea" class="replay-textarea"></textarea>
      <div class="replay-modal-actions">
        <button id="replay-action-btn" class="replay-button">执行</button>
        <button class="replay-button">关闭</button>
      </div>
    </div>
  </div>

  <div id="settings-modal" class="replay-modal-overlay" style="display: none;">
    <div class="replay-modal-content settings-modal-content">
      <h3>设置</h3>
      <div class="settings-row theme-settings-row">
        <div class="theme-selection-col">
          <label>棋子配色</label>
          <div class="custom-select-wrapper">
            <div class="custom-select">
              <div class="custom-select-trigger" id="theme-select-trigger">
                <span>选择主题</span>
                <div class="custom-arrow"></div>
              </div>
              <div class="custom-select-options" id="theme-select-options">
                <!-- Options populated by JS -->
              </div>
            </div>
          </div>
          <select id="theme-select" style="display:none"></select>
        </div>

        <div class="theme-preview-col">
          <label>配色预览</label>
          <div id="theme-preview-grid" class="theme-preview-grid"></div>
        </div>
      </div>
      <div class="settings-row">
        <div class="settings-note">霓虹主题：棋盘动态发光，计时器保持静态霓虹色。</div>
      </div>
      <div class="replay-modal-actions">
        <button id="settings-close-btn" class="replay-button">关闭</button>
      </div>
    </div>
  </div>

  <script src="js/seedrandom.js?v=1771576227074"></script>
  <script src="js/animframe_polyfill.js?v=1771576227074"></script>
  <script src="js/capped_input_manager.js?v=1771576227074"></script>
  <script src="js/theme_manager.js?v=1771576227074"></script>
  <script src="js/mode_catalog.js?v=1771576227074"></script>
  <script src="js/html_actuator.js?v=1771576227074"></script>
  <script src="js/grid.js?v=1771576227074"></script>
  <script src="js/tile.js?v=1771576227074"></script>
  <script src="js/local_score_manager.js?v=1771576227074"></script>
  <script src="js/api_client.js?v=1771576227074"></script>
  <script src="js/game_manager.js?v=1771576227074"></script>
  <script src="js/capped_application.js?v=1771576227074"></script>
  <script src="js/capped_timer_scroll.js?v=1771576227074"></script>
  <script src="js/index_ui.js?v=1771576227074"></script>
  <script>
  // === Guide overlay ===
  (function() {
      var guideKey = 'capped_guide_shown_v1';
      if (!localStorage.getItem(guideKey)) {
          var overlay = document.getElementById('guide-overlay');
          var message = document.getElementById('guide-message');
          var titleLink = document.querySelector('.title a');
          if (overlay && titleLink && message) {
              overlay.style.display = 'block';
              titleLink.classList.add('guide-highlight');
              var rect = titleLink.getBoundingClientRect();
              message.style.top = (rect.bottom + 15) + 'px';
              message.style.left = (rect.left + 20) + 'px';
              function dismiss() {
                  overlay.style.display = 'none';
                  titleLink.classList.remove('guide-highlight');
                  localStorage.setItem(guideKey, 'true');
              }
              overlay.addEventListener('click', dismiss);
              titleLink.addEventListener('click', function() { dismiss(); });
          }
      }
  })();

  </script>

</body>
</html>
