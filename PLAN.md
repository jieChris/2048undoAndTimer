# 功能改造实施计划（首页入口重构 + 主题系统）

## 1. 目标
- 首页新增顶部按钮区：`导出回放`、`高级回放`、`模式选择`、`设置`（并排）。
- 新增中间页 `modes.html`，承载 `练习板` 与 `2048封顶模式` 入口。
- 新增“设置”弹窗：支持棋子配色切换 + 小棋盘实时预览。
- 新增多套配色（覆盖 2~65536），包含“动态霓虹”主题。
- 主题切换时，计时器区域同步换色；霓虹主题下计时器使用静态颜色（不闪烁）。
- 左上/右上角统计字体放大 50%（仅角标，其他元素不变）。

## 2. 约束
- 不改变现有棋盘逻辑、回放逻辑、计时规则。
- 不打乱现有主布局：除新增按钮区外，其它元素位置和样式保持原状。
- 主题切换需持久化（`localStorage`），并在各页面一致生效。

## 3. 页面与文件改动范围
- 首页与入口：
  - `index.html`
  - `js/index_ui.js`
- 新页面：
  - `modes.html`（新增）
- 主题系统（全局）：
  - `js/theme_manager.js`（新增）
  - `style/main.css`（补充主题变量/动画/计时器样式钩子）
- 需要接入主题管理器的页面：
  - `index.html`
  - `replay.html`
  - `Practice_board.html`
  - `capped_2048.html`
- 已改统计角标逻辑（继续沿用并微调）：
  - `js/game_manager.js`

## 4. 实施步骤

### Step A: 首页按钮区与入口重构
1. 在 `index.html` 的分数区上方新增“顶部按钮条”容器（4 个按钮并排）。
2. 按钮条右边界对齐到“时间列”右侧边缘。
3. 保留原 `导出回放` 行为，改为按钮触发。
4. 将“练习板”“2048封顶模式”入口从首页移除，改为跳转 `modes.html`。

### Step B: 新增中间页 `modes.html`
1. 新建 `modes.html`，延续项目视觉风格（不改全站基调）。
2. 提供两个主入口按钮：
   - `前往练习板` -> `Practice_board.html`
   - `前往2048封顶模式` -> `capped_2048.html`
3. 提供返回首页入口。

### Step C: 设置弹窗与主题选择
1. 首页新增“设置”按钮，点击打开设置弹窗。
2. 弹窗内容：
   - 主题下拉选择器
   - 小型 4x4 预览棋盘（展示代表值，覆盖低/中/高段）
3. 切换主题时预览即时刷新。

### Step D: 主题系统实现
1. 新增 `js/theme_manager.js`，职责：
   - 定义主题映射（2~65536）
   - 应用主题（动态注入 CSS 变量/类）
   - 保存与读取主题（`localStorage`）
2. 主题方案（至少）：
   - 经典
   - 冷海
   - 森林
   - 极简灰
   - 高对比
   - Neon Flux（动态霓虹）
3. 各页面加载 `theme_manager.js`，启动时自动应用已选主题。

### Step E: 计时器同步换色（含霓虹例外）
1. 主题应用时同时更新：
   - `#timer`
   - 里程碑计时块（16~32768 与动态计时行）
2. Neon Flux 下规则：
   - 棋盘方块：保留动态霓虹动画
   - 计时器：固定霓虹色（`animation: none`）

### Step F: 角标字体放大
1. 将当前左上/右上角统计字体从现值提升 50%（例如 18px -> 27px）。
2. 仅修改角标字号，不影响其它字体与布局。

## 5. 验收清单
- 首页按钮区位置正确：在分数栏上方、右对齐时间列。
- 点击 `模式选择` 正常进入 `modes.html`。
- `modes.html` 两个模式入口可用且跳转正确。
- 设置弹窗可打开/关闭；切换主题后预览即时变化。
- 主题切换后棋盘颜色即时变化，刷新后保持。
- 主题在 `index/replay/practice/capped` 页面一致。
- 计时器颜色随主题切换；霓虹主题计时器不闪烁。
- 左上/右上统计角标字体已放大 50%。

## 6. 风险与处理
- 风险：不同页面 DOM 结构不同导致主题挂载点不一致。  
  处理：`theme_manager.js` 采用“存在即应用”的选择器策略，按页面容错。
- 风险：动态霓虹动画影响性能。  
  处理：动画只作用于棋盘 tile，计时器与其它区域禁用动画。
- 风险：首页新增按钮条影响旧布局。  
  处理：独立容器 + 精确对齐，不修改既有容器尺寸与流布局。

